# ç¬¬3èŠ‚ï¼šâ€œè‹˜é¦™è±†":é›¶ä»£ç æ­å»ºä½ çš„ RAG æ™ºèƒ½åŠ©ç†
> [è‹˜é¦™è±†webç«¯åœ°å€](https://openxlab.org.cn/apps/detail/tpoisonooo/huixiangdou-web)

> [è‹˜é¦™è±†GitHub](https://github.com/InternLM/huixiangdou)

# ä»‹ç»

èŒ´é¦™è±†æ˜¯ä¸€ä¸ªåŸºäº LLM çš„ç¾¤èŠçŸ¥è¯†åŠ©æ‰‹ï¼Œå¯ä»¥è®¾è®¡æ‹’ç­”ã€å“åº”ä¸¤é˜¶æ®µ pipeline åº”å¯¹ç¾¤èŠåœºæ™¯ï¼Œè§£ç­”é—®é¢˜åŒæ—¶ä¸ä¼šæ¶ˆæ¯æ³›æ»¥ã€‚æˆæœ¬ä½è‡³ 1.5G æ˜¾å­˜ï¼Œæ— éœ€è®­ç»ƒé€‚ç”¨å„è¡Œä¸šã€‚æä¾›ä¸€æ•´å¥—å‰åç«¯ webã€androidã€ç®—æ³•æºç ï¼Œå·¥ä¸šçº§å¼€æºå¯å•†ç”¨

## åœ¨[èŒ´é¦™è±† Web ç‰ˆ](https://openxlab.org.cn/apps/detail/tpoisonooo/huixiangdou-web)ä¸­åˆ›å»ºè‡ªå·±é¢†åŸŸçš„çŸ¥è¯†é—®ç­”åŠ©æ‰‹

### åœ¨[èŒ´é¦™è±† Web ç‰ˆ](https://openxlab.org.cn/apps/detail/tpoisonooo/huixiangdou-web)ä¸­åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†é—®ç­”åŠ©æ‰‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
- åˆ›å»ºè‡ªå·±çš„çŸ¥è¯†é—®ç­”åŠ©æ‰‹ï¼ˆps: çŸ¥è¯†åº“åç§°éœ€è¦8ä¸ªå­—ç¬¦ä»¥ä¸Šï¼Œå¦åˆ™æ— æ³•åˆ›å»ºï¼Œéœ€è¦è®°ä½çŸ¥è¯†åº“ç§˜å¯†ï¼Œä¸‹æ¬¡å¯ä»¥è¾“å…¥çŸ¥è¯†åº“åç§°ç›´æ¥è¿›å…¥çŸ¥è¯†åº“é—®ç­”ï¼‰
![cover](./docs/note3/1.jpg)

- ä¸Šä¼ çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆæ”¯æŒ/pdf/word/markdown/excelç­‰æ ¼å¼ï¼‰ï¼Œå¯ä¸Šä¼ å¤šä¸ªæ–‡æ¡£
![cover](./docs/note3/2.jpg)

- é’ˆå¯¹ä¸Šä¼ çš„çŸ¥è¯†åº“è¿›è¡Œå¯¹è¯
![cover](./docs/note3/3.jpg)
![cover](./docs/note3/4.jpg)

- æ·»åŠ æ­£åæ¯”ä¾‹ï¼ˆè®¾ç½®è¯¥é€‰é¡¹å¯è®©æ¨¡å‹æ›´ä¸“æ³¨äºé—®ç­”åœºæ™¯ï¼Œä»è€Œæé«˜é—®ç­”å‡†ç¡®ç‡åŠå¤„ç†ä¸åº”å›å¤çš„å¯¹è¯ï¼‰
  - è®¾ç½®æ­£ä¾‹ï¼šæ­£ä¾‹æ˜¯çœŸå®åœºæ™¯ä¸­ï¼Œæ¥è‡ªæé—®è€…çš„ã€éœ€ç­”å¤çš„é—®é¢˜
  - è®¾ç½®åä¾‹ï¼šåä¾‹æ˜¯çœŸå®åœºæ™¯ä¸­çš„é—²èŠï¼Œä¸åº”è¯¥ç­”å¤

## æœ¬åœ°éƒ¨ç½²â€œè‹˜é¦™è±†"webç‰ˆï¼ˆå¯é€‰ï¼‰

### ä»‹ç»
web ç‰ˆæœ¬å‰åç«¯æºç ï¼Œæ•ˆæœåŒ[èŒ´é¦™è±†](https://openxlab.org.cn/apps/detail/tpoisonooo/huixiangdou-web)

æ•´ä¸ªæœåŠ¡åˆ† å‰åç«¯ å’Œ ç®—æ³• ä¸¤éƒ¨åˆ†ï¼š

ä¸­é—´ç”¨ redis queue é€šä¿¡ï¼Œå¯ä»¥è§†åšæ¶ˆæ¯æ€»çº¿
åç«¯æ¥å—æ‰€æœ‰ä¸šåŠ¡ä¾§æ¶ˆæ¯ï¼Œä¾‹å¦‚å¾®ä¿¡ã€é£ä¹¦ã€æµè§ˆå™¨ç­‰
ç®—æ³•æ— çŠ¶æ€ï¼Œåªå…³å¿ƒç®—æ³•ç›¸å…³çš„ä»»åŠ¡ã€‚å¯åˆ†å¸ƒå¼æ‰©å±•ä»¥åº”å¯¹é«˜ååéœ€æ±‚

![cover](./docs/note3/5.png)
> æœ¬åœ°æ²¡æœ‰cudaç¯å¢ƒï¼Œæ”¾å¼ƒä½¿ç”¨ï¼Œè¿˜æ˜¯ä½¿ç”¨Intern Studioå¼€å‘æœºè¿›è¡Œéƒ¨ç½² [GitHub](https://github.com/InternLM/HuixiangDou/tree/main/web)

### ä¸‹è½½ä»£ç 
- [GitHub](https://github.com/InternLM/HuixiangDou/tree/main/web)

- å…‹éš†ä»“åº“æˆ–ç›´æ¥ä¸‹è½½åˆ°æœ¬åœ°
```angular2html
# å…‹éš†ä»“åº“
git clone https://github.com/InternLM/HuixiangDou/tree/main/web
# è¿›å…¥webæ–‡ä»¶å¤¹
cd web
```

### å®‰è£…ç¯å¢ƒ
- å®‰è£…redis: éœ€è¦redisæœåŠ¡ï¼Œæˆ‘æœ¬æœºå·²å®‰è£…è·³è¿‡è¯¥å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œè¯·å…ˆå®‰è£…redisæœåŠ¡
```angular2html
# ä»¥ Ubuntu ç³»ç»Ÿä¸ºä¾‹
# å®‰è£… Redis æœåŠ¡å’Œå®¢æˆ·ç«¯
sudo apt install redis-server redis-tools

# è®¾ç½® Redis å¯†ç ï¼ˆé»˜è®¤é…ç½®æ–‡ä»¶åœ¨/etc/redis/redis.confï¼‰ï¼Œæ¯”å¦‚è®¾ç½®ä¸ºï¼šredis123
sudo vim /etc/redis/redis.conf

# å°† requirepass your_password_here æ³¨é‡Šæ‰“å¼€å¹¶ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼Œä¿å­˜å³å¯
requirepass your_password_here

# å¯åŠ¨redis
sudo redis-server /etc/redis/redis.conf

# æŸ¥çœ‹redisæ˜¯å¦å¯åŠ¨æˆåŠŸ
netstat -nlpt | grep redis
```
- å®‰è£…nodeï¼šnodeç‰ˆæœ¬éœ€è¦ä¸º20.xï¼Œæˆ‘æœ¬æœºä¸º10.xï¼Œæ‰€ä»¥è¿›è¡Œå®‰è£…20.xç‰ˆæœ¬
```angular2html
# æˆ‘æœ¬æœºè£…äº†nvmï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨nvmå®‰è£…ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œè¯·å…ˆå®‰è£…nvmæˆ–è€…ç›´æ¥ç™¾åº¦node20ç‰ˆæœ¬è¿›è¡Œå®‰è£…
sipaote@sipaotedeMini ~ % nvm install 20
Downloading and installing node v20.12.2...
Downloading https://nodejs.org/dist/v20.12.2/node-v20.12.2-darwin-arm64.tar.xz...
######################################################################### 100.0%
Computing checksum with shasum -a 256
Checksums matched!
Now using node v20.12.2 (npm v10.5.0)

# ä¸Šè¿°å·²å®‰è£…æˆåŠŸï¼ŒæŸ¥çœ‹nodeç‰ˆæœ¬
sipaote@sipaotedeMini ~ % node -v
v20.12.2
```
- è®¾ç½®ç¯å¢ƒå˜é‡ï¼šå°†ä»¥ä¸‹å‘½ä»¤æ·»åŠ åˆ°~/.zshrcä¸­æœ«å°¾ï¼Œç„¶å source ~/.zshrc åˆ·æ–°é…ç½®
```
export PYTHONUNBUFFERED=1
# Redis çš„ IP åœ°å€
export REDIS_HOST=127.0.0.1
# Redis çš„å¯†ç 
export REDIS_PASSWORD=
# Redis çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 6379
export REDIS_PORT=6379
# JWT_SECRET æ˜¯æŒ‡ç”¨äºç­¾å JSON Web Token (JWT) çš„å¯†é’¥æˆ–å¯†é’¥å¯¹ï¼Œå¯ä»¥ä½¿ç”¨ `openssl rand -base64 32` å‘½ä»¤ç”Ÿæˆ
export JWT_SECRET=/DOrNHC3GsSNifASRzOcLHPbyTtwFk4Pv6ND44QIpmo=
# èŒ´é¦™è±†çš„åå°æœåŠ¡ç«¯å£ï¼Œå¯ä»¥è‡ªå®šä¹‰
export SERVER_PORT=7860
# é£ä¹¦çš„ LARK_ENCRYPT_KEYï¼Œå‚è€ƒåœ°å€ï¼šhttps://open.larksuite.com/document/server-docs/event-subscription/event-subscription-configure-/request-url-configuration-case
# å¦‚æœä¸éœ€è¦æ¥é€šé£ä¹¦å¿½ç•¥å³å¯
export HUIXIANGDOU_LARK_ENCRYPT_KEY=thisiskey
export HUIXIANGDOU_LARK_VERIFY_TOKEN=sMzyjKi9vMlEhKCZOVtBMhhl8x23z0AG

# set your service endpoint(open to Internet callback from lark and wechat)
# å›è°ƒç«¯å£ï¼Œå»ºè®®å¡«å†™ 7860ï¼Œç„¶åå°† 7860 ç«¯å£é€šè¿‡å…¬ç½‘ IP ä»£ç†å‡ºå»ï¼Œä¾‹å¦‚ http://10.1.52.36:18443
export HUIXIANGDOU_MESSAGE_ENDPOINT=http://192.168.110.33:7860
# å¦‚æœä½¿ç”¨ https å®‰å…¨è¿æ¥å°±æŠŠ COOKIE_SECURE è®¾ç½®ä¸º 1ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™å°† `export COOKIE_SECURE=1` æ›¿æ¢ä¸º `unset COOKIE_SECURE`
unset COOKIE_SECURE
```

## å¿ƒå¾— 
TODO

# 2.åœ¨ InternLM Studio ä¸Šéƒ¨ç½²èŒ´é¦™è±†æŠ€æœ¯åŠ©æ‰‹
[åŸæ•™ç¨‹é“¾æ¥](https://github.com/InternLM/Tutorial/blob/camp2/huixiangdou/readme.md)

## å®‰è£…condaç¯å¢ƒ
> è¯¥æ­¥éª¤çº¦èŠ±è´¹10å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…

```angular2html
#è¿›å…¥å¼€å‘æœºåï¼Œä½¿ç”¨å®˜æ–¹åŸºç¡€ç¯å¢ƒ`internlm-base`åˆ›å»ºï¼Œå‘½åä¸º InternLM2_Huixiangdouï¼Œ
studio-conda -o internlm-base -t InternLM2_Huixiangdou

#å¤åˆ¶å®Œæˆåï¼Œåœ¨æœ¬åœ°æŸ¥çœ‹ç¯å¢ƒ
conda env list

# ç»“æœå¦‚ä¸‹æ‰€ç¤º
# conda environments:
base                  *  /root/.conda
InternLM2_Huixiangdou                 /root/.conda/envs/InternLM2_Huixiangdou

# æ¿€æ´»InternLM2_Huixiangdou pythonè™šæ‹Ÿç¯å¢ƒ
conda activate InternLM2_Huixiangdou
```
## ä¸‹è½½åŸºç¡€æ–‡ä»¶

```angular2html
# åˆ›å»ºæ¨¡å‹æ–‡ä»¶å¤¹
cd /root && mkdir models

# å¤åˆ¶BCEæ¨¡å‹
ln -s /root/share/new_models/maidalun1020/bce-embedding-base_v1 /root/models/bce-embedding-base_v1
ln -s /root/share/new_models/maidalun1020/bce-reranker-base_v1 /root/models/bce-reranker-base_v1

# å¤åˆ¶å¤§æ¨¡å‹å‚æ•°ï¼ˆä¸‹é¢çš„æ¨¡å‹ï¼Œæ ¹æ®ä½œä¸šè¿›åº¦å’Œä»»åŠ¡è¿›è¡Œ**é€‰æ‹©ä¸€ä¸ª**å°±è¡Œï¼‰
ln -s /root/share/new_models/Shanghai_AI_Laboratory/internlm2-chat-7b /root/models/internlm2-chat-7b

```
## ä¸‹è½½å®‰è£…èŒ´é¦™è±†
- å®‰è£…èŒ´é¦™è±†è¿è¡Œæ‰€éœ€ä¾èµ–ã€‚
```angular2html
# å®‰è£… python ä¾èµ–
# pip install -r requirements.txt

pip install protobuf==4.25.3 accelerate==0.28.0 aiohttp==3.9.3 auto-gptq==0.7.1 bcembedding==0.1.3 beautifulsoup4==4.8.2 einops==0.7.0 faiss-gpu==1.7.2 langchain==0.1.14 loguru==0.7.2 lxml_html_clean==0.1.0 openai==1.16.1 openpyxl==3.1.2 pandas==2.2.1 pydantic==2.6.4 pymupdf==1.24.1 python-docx==1.1.0 pytoml==0.1.21 readability-lxml==0.8.1 redis==5.0.3 requests==2.31.0 scikit-learn==1.4.1.post1 sentence_transformers==2.2.2 textract==1.6.5 tiktoken==0.6.0 transformers==4.39.3 transformers_stream_generator==0.0.5 unstructured==0.11.2

## å› ä¸º Intern Studio ä¸æ”¯æŒå¯¹ç³»ç»Ÿæ–‡ä»¶çš„æ°¸ä¹…ä¿®æ”¹ï¼Œåœ¨ Intern Studio å®‰è£…éƒ¨ç½²çš„åŒå­¦ä¸å»ºè®®å®‰è£… Word ä¾èµ–ï¼Œåç»­çš„æ“ä½œå’Œä½œä¸šä¸ä¼šæ¶‰åŠ Word è§£æã€‚
## æƒ³è¦è‡ªå·±å°è¯•è§£æ Word æ–‡ä»¶çš„åŒå­¦ï¼Œuncomment æ‰ä¸‹é¢è¿™è¡Œï¼Œå®‰è£…è§£æ .doc .docx å¿…éœ€çš„ä¾èµ–
# apt update && apt -y install python-dev python libxml2-dev libxslt1-dev antiword unrtf poppler-utils pstotext tesseract-ocr flac ffmpeg lame libmad0 libsox-fmt-mp3 sox libjpeg-dev swig libpulse-dev

```
- ä»èŒ´é¦™è±†å®˜æ–¹ä»“åº“ä¸‹è½½èŒ´é¦™è±†ã€‚
```angular2html
cd /root
# ä¸‹è½½ repo
git clone https://github.com/internlm/huixiangdou && cd huixiangdou
git checkout 447c6f7e68a1657fce1c4f7c740ea1700bde0440

```

## ä½¿ç”¨èŒ´é¦™è±†æ­å»º RAG åŠ©æ‰‹
### ä¿®æ”¹é…ç½®æ–‡ä»¶
> ç”¨å·²ä¸‹è½½æ¨¡å‹çš„è·¯å¾„æ›¿æ¢ /root/huixiangdou/config.ini æ–‡ä»¶ä¸­çš„é»˜è®¤æ¨¡å‹ï¼Œéœ€è¦ä¿®æ”¹ 3 å¤„æ¨¡å‹åœ°å€

- ä¿®æ”¹ç”¨äºå‘é‡æ•°æ®åº“å’Œè¯åµŒå…¥çš„æ¨¡å‹
```angular2html
sed -i '7s#.*#reranker_model_path = "/root/models/bce-reranker-base_v1"#' /root/huixiangdou/config.ini
```
- ä¿®æ”¹ç”¨äºæ£€ç´¢çš„é‡æ’åºæ¨¡å‹
```angular2html
sed -i '6s#.*#embedding_model_path = "/root/models/bce-embedding-base_v1"#' /root/huixiangdou/config.ini
```

- ä¿®æ”¹æœ¬æ¬¡ä½¿ç”¨æ¨¡å‹
```angular2html
sed -i '29s#.*#local_llm_path = "/root/models/internlm2-chat-7b"#' /root/huixiangdou/config.ini
```

## åˆ›å»ºçŸ¥è¯†åº“
> æŒ‰ç…§æ•™ç¨‹ä¸­çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æ¥æº
-  ä¸‹è½½ Huixiangdou è¯­æ–™ï¼š
```angular2html
cd /root/huixiangdou && mkdir repodir

git clone https://github.com/internlm/huixiangdou --depth=1 repodir/huixiangdou
```

- å»ºç«‹æ¥å—å’Œæ‹’ç­”ä¸¤ä¸ªå‘é‡æ•°æ®åº“ï¼Œç”¨æ¥åœ¨æ£€ç´¢çš„è¿‡ç¨‹ä¸­æ›´åŠ ç²¾ç¡®çš„åˆ¤æ–­æé—®çš„ç›¸å…³æ€§ï¼ˆå¯é€‰ï¼‰
  - æ¥å—é—®é¢˜åˆ—è¡¨å­˜å‚¨åœ¨ huixiangdou/resource/good_questions.json ä¸­ ï¼ˆå¸Œæœ›èŒ´é¦™è±†åŠ©æ‰‹å›ç­”çš„ç¤ºä¾‹é—®é¢˜ï¼‰
  - æ‹’ç»é—®é¢˜åˆ—è¡¨å­˜å‚¨åœ¨ huixiangdou/resource/bad_questions.json ä¸­ ï¼ˆå¸Œæœ›èŒ´é¦™è±†åŠ©æ‰‹æ‹’ç­”çš„ç¤ºä¾‹é—®é¢˜ï¼‰
```angular2html
cd /root/huixiangdou
mv resource/good_questions.json resource/good_questions_bk.json

echo '[
    "mmposeä¸­æ€ä¹ˆè°ƒç”¨mmyoloæ¥å£",
    "mmposeå®ç°å§¿æ€ä¼°è®¡åæ€ä¹ˆå®ç°è¡Œä¸ºè¯†åˆ«",
    "mmposeæ‰§è¡Œæå–å…³é”®ç‚¹å‘½ä»¤ä¸æ˜¯åˆ†ä¸ºä¸¤æ­¥å—ï¼Œä¸€æ­¥æ˜¯ç›®æ ‡æ£€æµ‹ï¼Œå¦ä¸€æ­¥æ˜¯å…³é”®ç‚¹æå–ï¼Œæˆ‘ç°åœ¨ç›®æ ‡æ£€æµ‹è¿™éƒ¨åˆ†çš„ä»£ç æ˜¯demo/topdown_demo_with_mmdet.py demo/mmdetection_cfg/faster_rcnn_r50_fpn_coco.py checkpoints/faster_rcnn_r50_fpn_1x_coco_20200130-047c8118.pth   ç°åœ¨æˆ‘æƒ³æŠŠè¿™ä¸ªmmdetçš„checkpointsæ¢ä½yoloçš„ï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆæ“ä½œ",
    "åœ¨mmdetectionä¸­ï¼Œå¦‚ä½•åŒæ—¶åŠ è½½ä¸¤ä¸ªæ•°æ®é›†ï¼Œä¸¤ä¸ªdataloader",
    "å¦‚ä½•å°†mmdetection2.28.2çš„retinaneté…ç½®æ–‡ä»¶æ”¹ä¸ºå•å°ºåº¦çš„å‘¢ï¼Ÿ",
    "1.MMPose_Tutorial.ipynbã€inferencer_demo.pyã€image_demo.pyã€bottomup_demo.pyã€body3d_pose_lifter_demo.pyè¿™å‡ ä¸ªæ–‡ä»¶å’Œtopdown_demo_with_mmdet.pyçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œ\n2.æˆ‘å¦‚æœè¦ä½¿ç”¨mmdetæ˜¯ä¸æ˜¯å°±åªèƒ½ä½¿ç”¨topdown_demo_with_mmdet.pyæ–‡ä»¶ï¼Œ",
    "mmpose æµ‹è¯• map ä¸€ç›´æ˜¯ 0 æ€ä¹ˆåŠï¼Ÿ",
    "å¦‚ä½•ä½¿ç”¨mmposeæ£€æµ‹äººä½“å…³é”®ç‚¹ï¼Ÿ",
    "æˆ‘ä½¿ç”¨çš„æ•°æ®é›†æ˜¯labelmeæ ‡æ³¨çš„ï¼Œæˆ‘æƒ³çŸ¥é“mmposeçš„æ•°æ®é›†éƒ½æ˜¯ä»€ä¹ˆæ ·å¼çš„ï¼Œå…¨éƒ½æ˜¯å•ç›®æ ‡çš„æ•°æ®é›†æ ‡æ³¨ï¼Œè¿˜æ˜¯é‡Œè¾¹ä¹Ÿæœ‰å¤šç›®æ ‡ç„¶åè¿›è¡Œæ ‡æ³¨",
    "å¦‚ä½•ç”Ÿæˆopenmmposeçš„c++æ¨ç†è„šæœ¬",
    "mmpose",
    "mmposeçš„ç›®æ ‡æ£€æµ‹é˜¶æ®µè°ƒç”¨çš„æ¨¡å‹ï¼Œä¸€å®šè¦æ˜¯demoæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å—ï¼Œæœ‰æ²¡æœ‰å…¶ä»–è·¯å¾„ä¸‹çš„æ–‡ä»¶",
    "mmposeå¯ä»¥å®ç°è¡Œä¸ºè¯†åˆ«å—ï¼Œå¦‚æœè¦å®ç°çš„è¯åº”è¯¥æ€ä¹ˆåš",
    "æˆ‘åœ¨mmyoloçš„v0.6.0 (15/8/2023)æ›´æ–°æ—¥å¿—é‡Œçœ‹åˆ°äº†ä»–æ–°å¢äº†æ”¯æŒåŸºäº MMPose çš„ YOLOX-Poseï¼Œæˆ‘ç°åœ¨æ˜¯ä¸æ˜¯åªéœ€è¦åœ¨mmpose/project/yolox-Poseå†…åšå‡ºä¸€äº›è®¾ç½®å°±å¯ä»¥ï¼Œæ¢æ‰demo/mmdetection_cfg/faster_rcnn_r50_fpn_coco.py æ”¹ç”¨mmyoloæ¥è¿›è¡Œç›®æ ‡æ£€æµ‹äº†",
    "mac m1ä»æºç å®‰è£…çš„mmposeæ˜¯x86_64çš„",
    "æƒ³è¯·æ•™ä¸€ä¸‹mmposeæœ‰æ²¡æœ‰æä¾›å¯ä»¥è¯»å–å¤–æ¥æ‘„åƒå¤´ï¼Œåš3då§¿æ€å¹¶è¾¾åˆ°å®æ—¶çš„é¡¹ç›®å‘€ï¼Ÿ",
    "huixiangdou æ˜¯ä»€ä¹ˆï¼Ÿ",
    "ä½¿ç”¨ç§‘ç ”ä»ªå™¨éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ",
    "huixiangdou æ˜¯ä»€ä¹ˆï¼Ÿ",
    "èŒ´é¦™è±† æ˜¯ä»€ä¹ˆï¼Ÿ",
    "èŒ´é¦™è±† èƒ½éƒ¨ç½²åˆ°å¾®ä¿¡å—ï¼Ÿ",
    "èŒ´é¦™è±† æ€ä¹ˆåº”ç”¨åˆ°é£ä¹¦",
    "èŒ´é¦™è±† èƒ½éƒ¨ç½²åˆ°å¾®ä¿¡ç¾¤å—ï¼Ÿ",
    "èŒ´é¦™è±† æ€ä¹ˆåº”ç”¨åˆ°é£ä¹¦ç¾¤",
    "huixiangdou èƒ½éƒ¨ç½²åˆ°å¾®ä¿¡å—ï¼Ÿ",
    "huixiangdou æ€ä¹ˆåº”ç”¨åˆ°é£ä¹¦",
    "huixiangdou èƒ½éƒ¨ç½²åˆ°å¾®ä¿¡ç¾¤å—ï¼Ÿ",
    "huixiangdou æ€ä¹ˆåº”ç”¨åˆ°é£ä¹¦ç¾¤",
    "huixiangdou",
    "èŒ´é¦™è±†",
    "èŒ´é¦™è±† æœ‰å“ªäº›åº”ç”¨åœºæ™¯",
    "huixiangdou æœ‰ä»€ä¹ˆç”¨",
    "huixiangdou çš„ä¼˜åŠ¿æœ‰å“ªäº›ï¼Ÿ",
    "èŒ´é¦™è±† å·²ç»åº”ç”¨çš„åœºæ™¯",
    "huixiangdou å·²ç»åº”ç”¨çš„åœºæ™¯",
    "huixiangdou æ€ä¹ˆå®‰è£…",
    "èŒ´é¦™è±† æ€ä¹ˆå®‰è£…",
    "èŒ´é¦™è±† æœ€æ–°ç‰ˆæœ¬æ˜¯ä»€ä¹ˆ",
    "èŒ´é¦™è±† æ”¯æŒå“ªäº›å¤§æ¨¡å‹",
    "èŒ´é¦™è±† æ”¯æŒå“ªäº›é€šè®¯è½¯ä»¶",
    "config.ini æ–‡ä»¶æ€ä¹ˆé…ç½®",
    "remote_llm_model å¯ä»¥å¡«å“ªäº›æ¨¡å‹?"
]' > /root/huixiangdou/resource/good_questions.json

```
- åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨çš„é—®è¯¢åˆ—è¡¨ï¼Œç”¨æ¥æµ‹è¯•æ‹’ç­”æµç¨‹æ˜¯å¦èµ·æ•ˆ

```angular2html
cd /root/huixiangdou

echo '[
"huixiangdou æ˜¯ä»€ä¹ˆï¼Ÿ",
"ä½ å¥½ï¼Œä»‹ç»ä¸‹è‡ªå·±"
]' > ./test_queries.json

```
- åˆ›å»º RAG æ£€ç´¢è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å‘é‡æ•°æ®åº“
> åˆ›å»ºå®Œæˆåï¼ŒHuixiangdou ç›¸å…³çš„æ–°å¢çŸ¥è¯†å°±ä»¥å‘é‡æ•°æ®åº“çš„å½¢å¼å­˜å‚¨åœ¨ workdir æ–‡ä»¶å¤¹ä¸‹
```angular2html
# åˆ›å»ºå‘é‡æ•°æ®åº“å­˜å‚¨ç›®å½•
cd /root/huixiangdou && mkdir workdir 

# åˆ†åˆ«å‘é‡åŒ–çŸ¥è¯†è¯­æ–™ã€æ¥å—é—®é¢˜å’Œæ‹’ç»é—®é¢˜ä¸­åä¿å­˜åˆ° workdir
python3 -m huixiangdou.service.feature_store --sample ./test_queries.json

```
- è¿è¡ŒèŒ´é¦™è±†çŸ¥è¯†åŠ©æ‰‹

```angular2html
# å¡«å…¥é—®é¢˜
sed -i '74s/.*/    queries = ["huixiangdou æ˜¯ä»€ä¹ˆï¼Ÿ", "èŒ´é¦™è±†æ€ä¹ˆéƒ¨ç½²åˆ°å¾®ä¿¡ç¾¤", "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"]/' /root/huixiangdou/huixiangdou/main.py

# è¿è¡ŒèŒ´é¦™è±†
cd /root/huixiangdou/
python3 -m huixiangdou.main --standalone
```

> ä½¿ç”¨æ•™ç¨‹é‡Œé¢çš„åˆ†æ”¯åä¼šé‡åˆ°å¯åŠ¨å¤±è´¥é—®é¢˜å¦‚ä¸‹ï¼Œå¯ä»¥è€ƒè™‘åˆ‡æ¢mainåˆ†æ”¯ï¼Œæˆ–ä¿®æ”¹è·Ÿè·¯å¾„ä¸‹config.iniæ–‡ä»¶
```
# æŠ¥é”™å¦‚ä¸‹
Traceback (most recent call last):
  File "/root/.conda/envs/InternLM2_Huixiangdou/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/root/.conda/envs/InternLM2_Huixiangdou/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/root/huixiangdou/huixiangdou/main.py", line 211, in <module>
    run()
  File "/root/huixiangdou/huixiangdou/main.py", line 197, in run
    lark_send_only(assistant, fe_config)
  File "/root/huixiangdou/huixiangdou/main.py", line 76, in lark_send_only
    code, reply, references = assistant.generate(query=query,
  File "/root/huixiangdou/huixiangdou/service/worker.py", line 167, in generate
    tracker = QueryTracker(self.config['worker']['save_path'])
KeyError: 'save_path'

# ä¿®æ”¹ï¼šåœ¨config.iniæ–‡ä»¶æ·»åŠ save_path
[worker]
enable_sg_search = 0
local_llm_path = "/root/models/internlm2-chat-7b"
save_path = "logs/work.txt"
```
- é‡æ–°å¯åŠ¨åå‡ºç°å¦‚ä¸‹ç•Œé¢å³åˆ°æ­¤åŸºç¡€2ä½œä¸šå·²å®Œæˆ
![cover](./docs/note3/11.jpg)
![cover](./docs/note3/12.jpg)

## èŒ´é¦™è±†è¿›é˜¶ï¼ˆé€‰åšï¼‰
> åŠ å…¥ç½‘ç»œæœç´¢å’Œä½¿ç”¨è¿œç¨‹æ¨¡å‹å¯æŸ¥çœ‹åŸæ•™ç¨‹[æ•™ç¨‹åœ°å€](https://github.com/InternLM/Tutorial/blob/camp2/huixiangdou/readme.md)
## åˆ©ç”¨ Gradio æ­å»ºç½‘é¡µ Demo
- å®‰è£…å®‰è£… Gradio ä¾èµ–ç»„ä»¶
```angular2html
pip install gradio==4.25.0 redis==5.0.3 flask==3.0.2 lark_oapi==1.2.4
```
- è¿è¡Œè„šæœ¬ï¼Œå¯åŠ¨èŒ´é¦™è±†å¯¹è¯ Demo æœåŠ¡ï¼Œå®‰è£…å®Œä¹‹åæµè§ˆå™¨è¾“å…¥http://127.0.0.1:7860
- 
```
cd /root/huixiangdou
# æ­£å¸¸å¯åŠ¨ï¼Œä¸ä¼šå›å¤å…¶ä»–ä¿¡æ¯äº†
python3 -m tests.test_query_gradio
# ä»¥å‘é‡æ•°æ®åº“å¯åŠ¨
python3 -m tests.test_query_gradio --work_dir <å‘é‡æ•°æ®åº“è·¯å¾„ï¼šå¦‚ä¸Šè¿°åˆ›å»ºçš„`workdir`>
```

> å› ä½¿ç”¨çš„æ˜¯Studioå¼€å‘æœºï¼Œæ‰€ä»¥æœ¬åœ°éœ€è¦è®¿é—®åœ°å€127.0.0.1:7860æ—¶éœ€è¦è®¾ç½®ç«¯å£æ˜ å°„
- åœ¨Intern Studioå¼€å‘æœºåå°ç‚¹å‡»SSHé“¾æ¥æŸ¥çœ‹è‡ªå·±çš„ç«¯å£å·å’Œå¯†ç ï¼Œç«¯å£å·ä¸ºssh -p 43501 root@ssh.intern-ai.org.cnä¸­çš„43501

- åœ¨æœ¬åœ°æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå‘½ä»¤è¡Œä¼šæå‡è¾“å…¥å¯†ç 
```shell
# åˆ‡è®°å°†43501æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ç«¯å£å·
ssh -CNg -L 7860:127.0.0.1:7860 root@ssh.intern-ai.org.cn -p 43501
```
- é…ç½®å®Œæˆåœ¨æœ¬æœºæµè§ˆå™¨ä¸­è¾“å…¥http://127.0.0.1:7860è¿›è¡Œè®¿é—®ï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢åŠä»£è¡¨è¿è¡ŒæˆåŠŸ
  ![cover](./docs/note3/13.jpg)

## è¿›é˜¶ä½œä¸š éš¾åº¦4é¢—ğŸŒŸ

# èµ„æº
[æŠ€æœ¯æŠ¥å‘Š](https://arxiv.org/abs/2401.08772)
[èŒ´é¦™è±†æ··åˆæ¨¡å‹æŠ€æœ¯æŠ¥å‘Š](https://arxiv.org/abs/2401.08772)